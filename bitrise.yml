format_version: "8"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

project_type: react-native

app:
  envs:
  - PROJECT_LOCATION: android
  - MODULE: app
  - VARIANT:
  - SIGNED_ARTIFACT_NAME:
  - BITRISE_PROJECT_PATH: ios/apprn.xcodeproj
  - BITRISE_SCHEME: apprn
  - BITRISE_EXPORT_METHOD: development

workflows:
  integrate:
    steps:
    - script@1.1.5:
        title: NPM Install, Lint, Unit Test
        inputs:
        - content: |-
            #!/bin/bash -ex
            yarn
            yarn run lint
            yarn test
        - is_debug: $DEBUG_YES_NO
    - android-lint@0.9.6:
        inputs:
        - module: $MODULE
        - variant: $VARIANT
        - project_location: $PROJECT_LOCATION
    - android-unit-test@0.11.1:
        inputs:
        - is_debug: $DEBUG_TRUE_FALSE
        - module: $MODULE
        - variant: $VARIANT
        - project_location: $PROJECT_LOCATION
    - install-missing-android-tools@2.3.7:
        inputs:
        - gradlew_path: $PROJECT_LOCATION/gradlew
    - android-build@0.10.0:
        inputs:
        - module: $MODULE
        - variant: $VARIANT
        - project_location: $PROJECT_LOCATION
    - sign-apk@1.3.1:
        inputs:
        - output_name: $SIGNED_ARTIFACT_NAME
    #- set-ios-info-plist-unified@1.1.6:
    #    inputs:
    #    - app_icon_asset_catalog: "$APP_ICON_ASSET_CATALOG"
    #    - app_launch_images_asset_catalog: "$APP_LAUNCH_IMAGES_ASSET_CATALOG"
    #    - app_launch_screen: "$APP_LAUNCH_SCREEN"
    #    - bundle_display_name: "$BUNDLE_DISPLAY_NAME"
    #    - bundle_identifier: "$BUNDLE_IDENTIFIER"
    #    - bundle_name: "$BUNDLE_NAME"
    #    - bundle_version: "$BUNDLE_VERSION"
    #    - bundle_version_short: "$BUNDLE_VERSION_SHORT"
    #    - info_plist_file: "$INFO_PLIST_FILE"
    #- certificate-and-profile-installer@1.10.1: {}
    #- xcode-archive@2.5.0:
    #    inputs:
    #    - configuration: "$CONFIGURATION_NAME"
    #    - custom_export_options_plist_content: "$XCODEBUILD_EXPORT_METHOD"
    #    - force_code_sign_identity: "$FORCE_CODESIGN_IDENTITY"
    #    - force_provisioning_profile: "$FORCE_PROVISIONING_PROFILE_UUID"
    #    - force_provisioning_profile_specifier: "$FORCE_PROVISIONING_PROFILE_SPECIFIER"
    #    - force_team_id: "$FORCE_DEVELOPER_PORTAL_TEAM"
    #    - is_clean_build: "$CLEAN_BUILD_YES_NO"
    #    - is_export_xcarchive_zip: "$EXPORT_ZIP_YES_NO"
    #    - team_id: "$DEVELOPER_PORTAL_TEAM"
    #    - xcodebuild_options: "$XCODEBUILD_OPTIONS"
    #- xcode-analyze@2.1.0:
    #    inputs:
    #    - force_code_sign_identity: "$FORCE_CODE_SIGN_IDENTITY"
    #    - force_provisioning_profile: "$FORCE_PROVISIONING_PROFILE_UUID"
    - cache-push@2.2.0:
        inputs:
        - is_debug_mode: $DEBUG_TRUE_FALSE
    - deploy-to-bitrise-io@1.6.0:
        inputs:
        - debug_mode: $DEBUG_TRUE_FALSE

  deploy:
    steps:
    - cache-pull@2.0.1:
        inputs:
        - is_debug_mode: $DEBUG_TRUE_FALSE
    - apk_info@1.4.4: {}
    #- ipa-info@1.1.0: {}

  release:
    steps:
    - cache-pull@2.0.1:
        inputs:
        - is_debug_mode: $DEBUG_TRUE_FALSE
    - apk_info@1.4.4: {}
    #- ipa-info@1.1.0: {}

